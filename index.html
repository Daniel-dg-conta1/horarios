<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Horários - IFRS</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .card { background: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .legend-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 6px; }
        
        @media print {
            .no-print { display: none !important; }
            body { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .card { break-inside: avoid; border: 1px solid #ddd; box-shadow: none !important; }
        }
    </style>
</head>
<body class="pb-10">

    <!-- Header -->
    <header class="bg-slate-800 text-white p-6 shadow-lg print:bg-white print:text-black print:shadow-none">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold flex items-center gap-2">
                    <i class="fa-solid fa-calendar-days text-blue-400 print:text-black"></i> Gestão de Horários Acadêmicos
                </h1>
                <p class="text-slate-400 text-sm mt-1 print:text-gray-600">Análise Cruzada: Daniel Amoretti & Fernanda Bresciani</p>
            </div>
            <div class="mt-4 md:mt-0 flex items-center gap-4">
                <button onclick="window.print()" class="no-print bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-bold shadow-md transition-colors flex items-center gap-2">
                    <i class="fa-solid fa-print"></i> Imprimir
                </button>
                <div class="text-right">
                    <div class="text-xs font-semibold uppercase tracking-wider text-slate-400 print:text-gray-500">Semestre Atual</div>
                    <div class="font-mono" id="current-date"></div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 mt-8">

        <!-- KPIs / Resumo -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Daniel -->
            <div class="card p-5 border-l-4 border-blue-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-xs text-gray-500 font-bold uppercase">Aulas Daniel</p>
                        <h3 class="text-3xl font-bold text-gray-800" id="total-daniel">0</h3>
                        <p class="text-xs text-gray-400 mt-1">Períodos ocupados</p>
                    </div>
                    <div class="p-2 bg-blue-100 rounded-lg text-blue-600">
                        <i class="fa-solid fa-user-tie"></i>
                    </div>
                </div>
            </div>

            <!-- Fernanda -->
            <div class="card p-5 border-l-4 border-emerald-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-xs text-gray-500 font-bold uppercase">Aulas Fernanda</p>
                        <h3 class="text-3xl font-bold text-gray-800" id="total-fernanda">0</h3>
                        <p class="text-xs text-gray-400 mt-1">Períodos ocupados</p>
                    </div>
                    <div class="p-2 bg-emerald-100 rounded-lg text-emerald-600">
                        <i class="fa-solid fa-user-graduate"></i>
                    </div>
                </div>
            </div>

            <!-- Interseções -->
            <div class="card p-5 border-l-4 border-rose-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-xs text-gray-500 font-bold uppercase">Conflitos (Interseção)</p>
                        <h3 class="text-3xl font-bold text-gray-800" id="total-intersection">0</h3>
                        <p class="text-xs text-gray-400 mt-1">Horários simultâneos</p>
                    </div>
                    <div class="p-2 bg-rose-100 rounded-lg text-rose-600">
                        <i class="fa-solid fa-handshake-slash"></i>
                    </div>
                </div>
            </div>

            <!-- Livres -->
            <div class="card p-5 border-l-4 border-gray-400">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-xs text-gray-500 font-bold uppercase">Horários Livres (Comum)</p>
                        <h3 class="text-3xl font-bold text-gray-800" id="total-free">0</h3>
                        <p class="text-xs text-gray-400 mt-1">Ambos disponíveis</p>
                    </div>
                    <div class="p-2 bg-gray-200 rounded-lg text-gray-600">
                        <i class="fa-regular fa-clock"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Conteúdo Principal: Tabela e Gráficos -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Coluna Esquerda: Tabela de Horários (Ocupa 2/3) -->
            <div class="lg:col-span-2 space-y-8">
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-bold text-gray-800">Grade Horária Unificada</h2>
                        <div class="flex gap-4 text-xs font-medium">
                            <div class="flex items-center"><span class="legend-dot bg-blue-500"></span> Daniel</div>
                            <div class="flex items-center"><span class="legend-dot bg-emerald-500"></span> Fernanda</div>
                            <div class="flex items-center"><span class="legend-dot bg-rose-500"></span> Conflito</div>
                            <div class="flex items-center"><span class="legend-dot bg-gray-100 border border-gray-300"></span> Livre</div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50 border-b">
                                <tr>
                                    <th scope="col" class="px-3 py-3 w-24 sticky left-0 bg-gray-50 z-10">Horário</th>
                                    <th scope="col" class="px-3 py-3 text-center">Segunda</th>
                                    <th scope="col" class="px-3 py-3 text-center">Terça</th>
                                    <th scope="col" class="px-3 py-3 text-center">Quarta</th>
                                    <th scope="col" class="px-3 py-3 text-center">Quinta</th>
                                    <th scope="col" class="px-3 py-3 text-center">Sexta</th>
                                </tr>
                            </thead>
                            <tbody id="schedule-body">
                                <!-- Preenchido via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Lista de Horários Livres -->
                <div class="card p-6">
                    <h2 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fa-regular fa-calendar-check text-green-600 mr-2"></i>Janelas de Disponibilidade Conjunta
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">Lista de horários onde <strong>nenhum dos dois professores</strong> possui aula registrada.</p>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4" id="free-slots-container">
                        <!-- Preenchido via JS -->
                    </div>
                </div>
            </div>

            <!-- Coluna Direita: Gráficos e Análise (Ocupa 1/3) -->
            <div class="space-y-8">
                
                <!-- Análise Textual -->
                <div class="card p-6 bg-slate-50 border border-slate-200">
                    <h3 class="font-bold text-slate-800 mb-2">Análise de Dados (Ajustada)</h3>
                    <ul class="text-sm space-y-2 text-slate-600 list-disc list-inside">
                        <li><strong class="text-blue-600">Daniel</strong>: Aulas noturnas na <strong>Segunda</strong> (toda a noite) e <strong>Terça</strong> (apenas últimos horários).</li>
                        <li><strong class="text-emerald-600">Fernanda</strong>: Carga focada nas Segundas, Quartas e Sextas (Manhã/Tarde).</li>
                        <li id="conflict-analysis"></li>
                    </ul>
                </div>

                <!-- Gráfico de Barras -->
                <div class="card p-6">
                    <h3 class="font-bold text-gray-700 mb-4 text-sm text-center">Carga Horária por Dia (Períodos)</h3>
                    <canvas id="barChart"></canvas>
                </div>

                <!-- Gráfico de Rosca -->
                <div class="card p-6">
                    <h3 class="font-bold text-gray-700 mb-4 text-sm text-center">Distribuição Total da Grade</h3>
                    <div class="relative h-48">
                        <canvas id="doughnutChart"></canvas>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <footer class="mt-12 py-6 text-center text-gray-400 text-sm">
        <p>Dashboard atualizado com correção manual das aulas noturnas.</p>
    </footer>

    <!-- Lógica JavaScript -->
    <script>
        // Dados REVISADOS (Segunda E Terça à noite incluídas para Daniel)
        // D = Daniel, F = Fernanda
        const rawData = [
            { time: "07:30 - 08:20", mo: {d: "", f: "Biologia I (3TPm)"}, tu: {d: "", f: ""}, we: {d: "", f: ""}, th: {d: "Usinagem (3TFMm)", f: ""}, fr: {d: "", f: "Biologia I (3TFMm)"} },
            { time: "08:20 - 09:10", mo: {d: "", f: "Biologia I (3TPm)"}, tu: {d: "", f: ""}, we: {d: "", f: ""}, th: {d: "Usinagem (3TFMm)", f: ""}, fr: {d: "", f: "Biologia I (3TFMm)"} },
            { time: "09:10 - 10:00", mo: {d: "", f: ""}, tu: {d: "", f: ""}, we: {d: "", f: ""}, th: {d: "Usinagem (3TFMm)", f: ""}, fr: {d: "", f: ""} },
            { time: "10:20 - 11:10", mo: {d: "", f: "Biotecnologia (4TQm)"}, tu: {d: "", f: ""}, we: {d: "", f: ""}, th: {d: "Tec. Mecânica (2TFMm)", f: ""}, fr: {d: "", f: "Biologia I (3TQm)"} },
            { time: "11:10 - 12:00", mo: {d: "", f: "Biotecnologia (4TQm)"}, tu: {d: "", f: ""}, we: {d: "", f: ""}, th: {d: "Tec. Mecânica (2TFMm)", f: ""}, fr: {d: "", f: "Biologia I (3TQm)"} },
            { time: "13:30 - 14:20", mo: {d: "", f: ""}, tu: {d: "", f: ""}, we: {d: "", f: "Biotecnologia (4TQt)"}, th: {d: "Tec. Mecânica (2TFMt)", f: ""}, fr: {d: "", f: "Biologia I (3TPt)"} },
            { time: "14:20 - 15:10", mo: {d: "", f: ""}, tu: {d: "", f: ""}, we: {d: "", f: "Biotecnologia (4TQt)"}, th: {d: "Tec. Mecânica (2TFMt)", f: ""}, fr: {d: "", f: "Biologia I (3TPt)"} },
            { time: "15:30 - 16:20", mo: {d: "", f: "Biologia I (3TFMt)"}, tu: {d: "Usinagem (4TFMt)", f: ""}, we: {d: "", f: ""}, th: {d: "", f: ""}, fr: {d: "", f: ""} },
            { time: "16:20 - 17:10", mo: {d: "", f: "Biologia I (3TFMt)"}, tu: {d: "Usinagem (4TFMt)", f: ""}, we: {d: "", f: "Biologia I (3TQt)"}, th: {d: "", f: ""}, fr: {d: "", f: ""} },
            { time: "17:10 - 18:00", mo: {d: "", f: ""}, tu: {d: "Usinagem (4TFMt)", f: ""}, we: {d: "", f: "Biologia I (3TQt)"}, th: {d: "", f: ""}, fr: {d: "", f: ""} },
            { time: "18:00 - 18:50", mo: {d: "", f: ""}, tu: {d: "", f: ""}, we: {d: "", f: ""}, th: {d: "", f: ""}, fr: {d: "", f: ""} },
            // Aulas noturnas: Daniel ocupa Segunda (toda) e Terça (apenas final)
            { time: "18:50 - 19:40", mo: {d: "Comando Numérico (9 EM)", f: ""}, tu: {d: "", f: ""}, we: {d: "", f: ""}, th: {d: "", f: ""}, fr: {d: "", f: ""} },
            { time: "19:40 - 20:30", mo: {d: "Comando Numérico (9 EM)", f: ""}, tu: {d: "", f: ""}, we: {d: "", f: ""}, th: {d: "", f: ""}, fr: {d: "", f: ""} },
            { time: "20:40 - 21:30", mo: {d: "Comando Numérico (9 EM)", f: ""}, tu: {d: "Proc. Usinagem I (7 EM)", f: ""}, we: {d: "", f: ""}, th: {d: "", f: ""}, fr: {d: "", f: ""} },
            { time: "21:30 - 22:20", mo: {d: "Comando Numérico (9 EM)", f: ""}, tu: {d: "Proc. Usinagem I (7 EM)", f: ""}, we: {d: "", f: ""}, th: {d: "", f: ""}, fr: {d: "", f: ""} }
        ];

        const days = ['mo', 'tu', 'we', 'th', 'fr'];
        const dayNames = { mo: 'Segunda', tu: 'Terça', we: 'Quarta', th: 'Quinta', fr: 'Sexta' };

        // --- Lógica de Processamento ---
        let stats = {
            daniel: 0,
            fernanda: 0,
            intersection: 0,
            free: 0,
            byDay: { mo: {d:0, f:0}, tu: {d:0, f:0}, we: {d:0, f:0}, th: {d:0, f:0}, fr: {d:0, f:0} }
        };

        const freeSlots = [];

        rawData.forEach(slot => {
            let isSlotFree = true;

            days.forEach(day => {
                const dClass = slot[day].d;
                const fClass = slot[day].f;
                let hasD = dClass !== "";
                let hasF = fClass !== "";

                // Totais
                if (hasD) stats.daniel++;
                if (hasF) stats.fernanda++;
                if (hasD && hasF) stats.intersection++;
                if (!hasD && !hasF) stats.free++; // Total de células livres na grade

                // Por Dia
                if (hasD) stats.byDay[day].d++;
                if (hasF) stats.byDay[day].f++;

                // Verificar se horário inteiro é livre (todos os dias vazios nesse horário? Não, a lógica é por célula, mas vamos listar células livres)
                if (dClass === "" && fClass === "") {
                     freeSlots.push({ day: dayNames[day], time: slot.time });
                }
            });
        });

        // --- Renderização da Tabela ---
        const tbody = document.getElementById('schedule-body');
        
        rawData.forEach((row, index) => {
            const tr = document.createElement('tr');
            tr.className = "bg-white border-b hover:bg-gray-50 transition-colors";
            
            // Coluna Horário
            const tdTime = document.createElement('td');
            tdTime.className = "px-3 py-3 font-medium text-gray-900 whitespace-nowrap sticky left-0 bg-white shadow-[2px_0_5px_-2px_rgba(0,0,0,0.1)]";
            tdTime.innerText = row.time;
            tr.appendChild(tdTime);

            // Colunas Dias
            days.forEach(day => {
                const td = document.createElement('td');
                const dClass = row[day].d;
                const fClass = row[day].f;
                
                td.className = "px-3 py-3 text-center align-top border-l border-gray-100";

                let content = '';
                let cellClass = '';

                if (dClass && fClass) {
                    // Conflito
                    cellClass = "bg-rose-50 border-rose-200 text-rose-800";
                    content = `
                        <div class="text-xs font-bold mb-1">⚠️ Conflito</div>
                        <div class="mb-1 p-1 bg-blue-100 text-blue-800 rounded text-xs">${dClass}</div>
                        <div class="p-1 bg-emerald-100 text-emerald-800 rounded text-xs">${fClass}</div>
                    `;
                } else if (dClass) {
                    // Só Daniel
                    cellClass = "bg-blue-50 text-blue-700";
                    content = `<div class="font-semibold text-xs">${dClass}</div><div class="text-[10px] text-blue-400 mt-1 uppercase">Daniel</div>`;
                } else if (fClass) {
                    // Só Fernanda
                    cellClass = "bg-emerald-50 text-emerald-700";
                    content = `<div class="font-semibold text-xs">${fClass}</div><div class="text-[10px] text-emerald-400 mt-1 uppercase">Fernanda</div>`;
                } else {
                    // Livre
                    content = `<span class="text-gray-300">-</span>`;
                }

                if (cellClass) td.classList.add(...cellClass.split(" "));
                td.innerHTML = content;
                tr.appendChild(td);
            });

            tbody.appendChild(tr);
        });

        // --- Atualizar KPIs ---
        document.getElementById('total-daniel').innerText = stats.daniel;
        document.getElementById('total-fernanda').innerText = stats.fernanda;
        document.getElementById('total-intersection').innerText = stats.intersection;
        document.getElementById('total-free').innerText = stats.free; // Células livres totais

        // --- Renderizar Lista de Livres ---
        const freeContainer = document.getElementById('free-slots-container');
        freeContainer.innerHTML = ''; // Limpar antes de renderizar
        
        // Agrupar por dia para melhor visualização
        const freeByDay = {};
        freeSlots.forEach(slot => {
            if (!freeByDay[slot.day]) freeByDay[slot.day] = [];
            freeByDay[slot.day].push(slot.time);
        });

        Object.keys(freeByDay).forEach(day => {
            const div = document.createElement('div');
            div.className = "p-4 bg-gray-50 rounded-lg border border-gray-200";
            
            let timesHtml = freeByDay[day].map(t => `<span class="inline-block bg-white border border-gray-300 text-gray-600 text-xs px-2 py-1 rounded mb-1 mr-1">${t}</span>`).join('');
            
            div.innerHTML = `
                <h4 class="font-bold text-gray-700 mb-2 border-b pb-1">${day}</h4>
                <div class="flex flex-wrap">
                    ${timesHtml}
                </div>
            `;
            freeContainer.appendChild(div);
        });

        // --- Análise de Conflito ---
        const conflictEl = document.getElementById('conflict-analysis');
        if (stats.intersection === 0) {
            conflictEl.innerHTML = `<strong class="text-green-600">Excelente Compatibilidade:</strong> Não existem conflitos de horário entre os dois professores. As grades são perfeitamente complementares.`;
        } else {
            conflictEl.innerHTML = `<strong class="text-rose-600">Atenção:</strong> Existem ${stats.intersection} períodos de conflito.`;
        }

        // --- Gráficos (Chart.js) ---

        // 1. Bar Chart (Por dia)
        const ctxBar = document.getElementById('barChart').getContext('2d');
        new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta'],
                datasets: [
                    {
                        label: 'Daniel',
                        data: [stats.byDay.mo.d, stats.byDay.tu.d, stats.byDay.we.d, stats.byDay.th.d, stats.byDay.fr.d],
                        backgroundColor: 'rgba(59, 130, 246, 0.7)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    },
                    {
                        label: 'Fernanda',
                        data: [stats.byDay.mo.f, stats.byDay.tu.f, stats.byDay.we.f, stats.byDay.th.f, stats.byDay.fr.f],
                        backgroundColor: 'rgba(16, 185, 129, 0.7)',
                        borderColor: 'rgba(16, 185, 129, 1)',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, stepSize: 1, title: {display: true, text: 'Qtd. Aulas'} }
                }
            }
        });

        // 2. Doughnut Chart (Ocupação Total)
        const ctxDoughnut = document.getElementById('doughnutChart').getContext('2d');
        const totalSlots = rawData.length * 5; // 15 horários * 5 dias
        const totalOccupied = stats.daniel + stats.fernanda - stats.intersection; // Subtrai interseção para não contar duplo espaço físico
        const totalEmpty = totalSlots - totalOccupied;

        new Chart(ctxDoughnut, {
            type: 'doughnut',
            data: {
                labels: ['Aulas Daniel', 'Aulas Fernanda', 'Livres'],
                datasets: [{
                    data: [stats.daniel, stats.fernanda, totalEmpty],
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(16, 185, 129, 0.8)',
                        'rgba(229, 231, 235, 0.8)'
                    ],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'right' }
                }
            }
        });

        // Data Atual
        const now = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('current-date').innerText = now.toLocaleDateString('pt-BR', options);

    </script>
</body>
</html>
